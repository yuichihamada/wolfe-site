{% extends "base.html" %}
{% block title %}{{ page.title }} | ロードマップ{% endblock %}

{% block content %}

<section class="max-w-4xl mx-auto px-4 pb-10 space-y-10">

  {% if page.cover_image %}
    <div class="relative left-1/2 right-1/2 -ml-[50vw] -mr-[50vw] w-screen">
      <img
        src="{{ page.cover_image.url }}"
        alt="{{ page.title }}"
        class="w-full h-40 md:h-56 object-cover"
        loading="lazy"
      />
    </div>
  {% endif %}

  <!-- パンくず -->
  <nav class="max-w-4xl mx-auto text-sm text-gray-500 mt-4">
    <a href="{% url 'roadmap_home' %}" class="hover:underline">ロードマップ</a>
    <span class="mx-1">›</span>
    <span>{{ roadmap.name }}</span>
  </nav>

  <!-- タイトル -->
  <header class="space-y-3 relative z-10 mt-4">
    <h1 class="text-2xl md:text-3xl font-bold">{{ page.title }}</h1>
  </header>

  {% if body_toc %}
    <aside class="border rounded-xl bg-white p-4">
      <div class="font-semibold mb-3">MENU</div>
      <div class="prose prose-sm max-w-none">
        {{ body_toc|safe }}
      </div>
    </aside>
  {% endif %}

  <!-- 本文 -->
  <article class="prose max-w-none">
    {{ body_html|safe }}
  </article>

  <!-- 次に読む -->
  {% if prev_page or next_page %}
    <section class="pt-10 border-t">
      <div class="grid gap-4 sm:grid-cols-2">
        {% if prev_page %}
          <a href="{% url 'roadmap_page_detail' roadmap.slug prev_page.slug %}"
             class="group overflow-hidden rounded-2xl border bg-white hover:bg-zinc-50/40 transition">

            {% if prev_page.cover_image %}
              <div class="h-28 sm:h-32 w-full overflow-hidden bg-zinc-100">
                <img
                  src="{{ prev_page.cover_image.url }}"
                  alt="{{ prev_page.title }}"
                  class="h-full w-full object-cover group-hover:scale-[1.02] transition"
                  loading="lazy"
                />
              </div>
            {% else %}
              <div class="h-28 sm:h-32 w-full bg-zinc-100"></div>
            {% endif %}

            <div class="p-4">
              <p class="text-xs font-semibold text-zinc-500 mb-1">
                ← 前の記事
              </p>
              <p class="font-semibold leading-snug line-clamp-2">
                {{ prev_page.title }}
              </p>
              <p class="mt-1 text-sm text-zinc-500">
                STEP{{ roadmap.order|stringformat:"02d" }}
              </p>
            </div>
          </a>
        {% endif %}

        {% if next_page %}
          <a href="{% url 'roadmap_page_detail' roadmap.slug next_page.slug %}"
             class="group overflow-hidden rounded-2xl border bg-white hover:bg-zinc-50/40 transition">

            {% if next_page.cover_image %}
              <div class="h-28 sm:h-32 w-full overflow-hidden bg-zinc-100">
                <img
                  src="{{ next_page.cover_image.url }}"
                  alt="{{ next_page.title }}"
                  class="h-full w-full object-cover group-hover:scale-[1.02] transition"
                  loading="lazy"
                />
              </div>
            {% else %}
              <div class="h-28 sm:h-32 w-full bg-zinc-100"></div>
            {% endif %}

            <div class="p-4">
              <p class="text-xs font-semibold text-zinc-500 mb-1">
                次の記事 →
              </p>
              <p class="font-semibold leading-snug line-clamp-2">
                {{ next_page.title }}
              </p>
              <p class="mt-1 text-sm text-zinc-500">
                STEP{{ roadmap.order|stringformat:"02d" }}
              </p>
            </div>
          </a>
        {% endif %}
      </div>
    </section>
  {% endif %}

  <!-- ロードマップに戻る -->
  <div class="pt-6 text-center">
    <a href="{% url 'roadmap_home' %}"
       class="inline-flex items-center gap-2 text-sm font-semibold text-zinc-600 hover:text-zinc-900 transition">
      ← ロードマップに戻る
    </a>
  </div>

</section>
{% endblock %}
